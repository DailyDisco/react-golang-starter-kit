# ============================================
# React + Go Starter Kit - Staging Environment Template
# ============================================
# USAGE: Copy this file to .env.staging and fill in your values
#   cp .env.staging.example .env.staging
#
# Staging is a production-like environment for testing before release.
# It should mirror production settings but with:
# - Separate database and infrastructure
# - More verbose logging for debugging
# - Test payment keys (Stripe test mode)
# - Relaxed rate limits for QA testing
#
# WARNING: Never commit .env.staging to version control!

# ============================================
# 1. CORE APPLICATION SETTINGS
# ============================================

API_PORT=8080
API_HOST=0.0.0.0
GO_ENV=staging
DEBUG=false
SERVER_TIMEOUT=30s

# ============================================
# 2. DOCKER CONFIGURATION
# ============================================

PROJECT_NAME=starter-kit-staging
BACKEND_PORT=8080

# ============================================
# 3. DATABASE CONFIGURATION
# ============================================

# Use a separate staging database
DB_HOST=staging-postgres-host
DB_PORT=5432
DB_USER=staging_user
DB_PASSWORD=your-staging-database-password
DB_NAME=starter_kit_staging

# Use SSL in staging (mirrors production)
DB_SSLMODE=require

# Connection Pool Settings
DB_POOL_MAX_CONNS=15
DB_POOL_MIN_CONNS=3
DB_POOL_MAX_CONN_LIFETIME_MINUTES=5
DB_POOL_MAX_CONN_IDLE_TIME_MINUTES=1
DB_POOL_HEALTH_CHECK_SECONDS=30

# Query Profiling (more aggressive for catching issues)
DB_SLOW_QUERY_THRESHOLD=50ms
DB_LOG_ALL_QUERIES=false

# ============================================
# 4. AUTHENTICATION & SECURITY
# ============================================

# Generate a unique secret for staging: openssl rand -hex 32
JWT_SECRET=your-staging-jwt-secret-generate-with-openssl

JWT_EXPIRATION_HOURS=24
ACCESS_TOKEN_EXPIRATION_MINUTES=15
REFRESH_TOKEN_EXPIRATION_DAYS=7

COOKIE_SAMESITE=strict
TOKEN_BLACKLIST_FAIL_MODE=closed

# CSRF Protection
CSRF_ENABLED=true
CSRF_COOKIE_SECURE=true
CSRF_COOKIE_DOMAIN=staging.yourdomain.com
CSRF_COOKIE_SAMESITE=strict

# Security Headers (mirrors production)
SECURITY_HEADERS_ENABLED=true
SECURITY_CSP="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'"
SECURITY_FRAME_OPTIONS=DENY
SECURITY_HSTS_ENABLED=true
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin
SECURITY_PERMISSIONS_POLICY="geolocation=(), microphone=(), camera=()"

# TOTP/2FA
TOTP_ISSUER=YourAppName-Staging
SITE_NAME=YourAppName Staging
TOTP_ENCRYPTION_KEY=your-staging-totp-encryption-key

# ============================================
# 5. CORS CONFIGURATION
# ============================================

# Staging frontend URLs
CORS_ALLOWED_ORIGINS=https://staging.yourdomain.com,https://staging-app.yourdomain.com

# ============================================
# 6. RATE LIMITING
# ============================================

RATE_LIMIT_ENABLED=true

# Relaxed limits for QA testing
RATE_LIMIT_IP_PER_MINUTE=120
RATE_LIMIT_IP_PER_HOUR=2000
RATE_LIMIT_IP_BURST_SIZE=20

RATE_LIMIT_USER_PER_MINUTE=200
RATE_LIMIT_USER_PER_HOUR=4000
RATE_LIMIT_USER_BURST_SIZE=40

# Auth limits still restrictive
RATE_LIMIT_AUTH_PER_MINUTE=10
RATE_LIMIT_AUTH_PER_HOUR=200
RATE_LIMIT_AUTH_BURST_SIZE=5

RATE_LIMIT_API_PER_MINUTE=200
RATE_LIMIT_API_PER_HOUR=4000
RATE_LIMIT_API_BURST_SIZE=40

# ============================================
# 7. LOGGING CONFIGURATION
# ============================================

LOG_ENABLED=true
LOG_LEVEL=debug
LOG_PRETTY=false

# More verbose for debugging staging issues
LOG_INCLUDE_USER_CONTEXT=true
LOG_INCLUDE_REQUEST_BODY=false
LOG_INCLUDE_RESPONSE_BODY=false

LOG_MAX_REQUEST_BODY_SIZE=2048
LOG_MAX_RESPONSE_BODY_SIZE=2048

# Full sampling in staging
LOG_SAMPLING_RATE=1.0
LOG_ASYNC=true

LOG_SANITIZE_HEADERS=true
LOG_FILTER_SENSITIVE=true
LOG_ALLOWED_HEADERS=accept,content-type,user-agent,x-request-id,x-forwarded-for
LOG_TIME_FORMAT=2006-01-02T15:04:05Z07:00

# ============================================
# 8. CACHING CONFIGURATION (Dragonfly/Redis)
# ============================================

CACHE_ENABLED=true
CACHE_TYPE=redis
CACHE_KEY_PREFIX=staging

REDIS_URL=redis://staging-dragonfly:6379/0
REDIS_PASSWORD=your-staging-redis-password
REDIS_REQUIRED=true

DRAGONFLY_MEMORY=384mb
DRAGONFLY_MEMORY_LIMIT=384M
DRAGONFLY_MEMORY_RESERVE=128M

REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=3
REDIS_MAX_IDLE_CONNS=5

CACHE_DEFAULT_TTL=300
CACHE_HEALTH_CHECK_TTL=30
CACHE_USER_PROFILE_TTL=120
CACHE_SESSION_TTL=900

# ============================================
# 9. FILE STORAGE
# ============================================

MAX_FILE_SIZE_MB=10

# Use separate S3 bucket for staging
# AWS_ACCESS_KEY_ID=your-staging-aws-key
# AWS_SECRET_ACCESS_KEY=your-staging-aws-secret
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=your-staging-bucket

DATA_EXPORTS_DIR=./exports

# ============================================
# 10. DATABASE MIGRATIONS
# ============================================

RUN_MIGRATIONS=true
MIGRATIONS_PATH=./migrations

# ============================================
# 11. BACKGROUND JOBS (River)
# ============================================

JOBS_ENABLED=true
JOBS_WORKER_COUNT=5
JOBS_MAX_RETRIES=3
JOBS_TIMEOUT=30s

METRICS_RETENTION_ENABLED=true
METRICS_RETENTION_DAYS=14

# ============================================
# 12. EMAIL SERVICE (SMTP)
# ============================================

EMAIL_ENABLED=true

# Use Resend or similar for staging
SMTP_HOST=smtp.resend.com
SMTP_PORT=587
SMTP_USER=resend
SMTP_PASSWORD=re_your-staging-resend-api-key
SMTP_TLS_POLICY=required

# Use staging-specific sender
SMTP_FROM=staging@yourdomain.com
SMTP_FROM_NAME=Your App (Staging)

FRONTEND_URL=https://staging.yourdomain.com

# Can enable dev mode to log emails instead of sending
EMAIL_DEV_MODE=false

# ============================================
# 13. OAUTH PROVIDERS
# ============================================

# Use same OAuth apps as production, or create staging-specific ones
# GOOGLE_CLIENT_ID=your-staging-google-client-id
# GOOGLE_CLIENT_SECRET=your-staging-google-client-secret
# GITHUB_CLIENT_ID=your-staging-github-client-id
# GITHUB_CLIENT_SECRET=your-staging-github-client-secret

OAUTH_REDIRECT_BASE_URL=https://staging.yourdomain.com

# ============================================
# 14. STRIPE PAYMENTS
# ============================================
#
# IMPORTANT: Use TEST keys in staging (sk_test_*, pk_test_*)

STRIPE_ENABLED=true

# Use TEST keys - never live keys in staging
STRIPE_SECRET_KEY=sk_test_your-stripe-test-secret-key
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-test-publishable-key
STRIPE_WEBHOOK_SECRET=whsec_your-staging-webhook-secret

STRIPE_SUCCESS_URL=https://staging.yourdomain.com/billing/success
STRIPE_CANCEL_URL=https://staging.yourdomain.com/billing/cancel
STRIPE_PORTAL_RETURN_URL=https://staging.yourdomain.com/billing

# Use test price IDs
# STRIPE_PREMIUM_PRICE_ID=price_test_premium
# STRIPE_ENTERPRISE_PRICE_ID=price_test_enterprise

# ============================================
# 15. AI SERVICES (Gemini)
# ============================================

GEMINI_ENABLED=false
# GEMINI_API_KEY=your-staging-gemini-api-key
GEMINI_MODEL=gemini-2.0-flash
GEMINI_EMBEDDING_MODEL=text-embedding-004
GEMINI_MAX_TOKENS=8192
GEMINI_TIMEOUT_SECONDS=30
GEMINI_MAX_IMAGE_SIZE_MB=10

GEMINI_SAFETY_LEVEL=medium
GEMINI_MAX_PROMPT_LENGTH=100000
GEMINI_MAX_MESSAGES_PER_CHAT=50
GEMINI_MAX_TEXTS_PER_EMBED=100
GEMINI_ALLOW_FUNCTION_CALLING=true
GEMINI_ALLOW_JSON_MODE=true

RATE_LIMIT_AI_PER_MINUTE=30
RATE_LIMIT_AI_PER_HOUR=300
RATE_LIMIT_AI_BURST_SIZE=10

# ============================================
# 16. MONITORING & ERROR TRACKING
# ============================================

# Use separate Sentry project for staging
SENTRY_DSN=https://your-staging-sentry-dsn@o123456.ingest.sentry.io/staging
SENTRY_ENVIRONMENT=staging
SENTRY_DEBUG=false
APP_VERSION=staging

# ============================================
# 17. FRONTEND (Vite)
# ============================================

VITE_API_URL=https://api-staging.yourdomain.com
SSR_API_URL=http://backend:8080

VITE_SENTRY_DSN=https://your-staging-frontend-sentry-dsn
VITE_SENTRY_ENABLE_DEV=false
VITE_APP_VERSION=staging

# Feature flags - can enable experimental features
VITE_FEATURE_NEW_DASHBOARD_LAYOUT=true
VITE_FEATURE_BETA_ANALYTICS=true
VITE_FEATURE_ADVANCED_FILE_UPLOAD=true
VITE_FEATURE_USER_ROLES_MANAGEMENT=true
VITE_FEATURE_DARK_MODE_TOGGLE=true
VITE_FEATURE_EXPERIMENTAL_CHARTS=true

VITE_ENABLE_DEVTOOLS=true
VITE_DEBUG_MODE=true

# ============================================
# 18. DATABASE SEEDING
# ============================================

# Can seed staging with test data
AUTO_SEED=false
SEED_ADMIN_PASSWORD=staging-admin-password
SEED_DEFAULT_PASSWORD=staging-user-password

# ============================================
# 19. DATABASE BACKUPS
# ============================================

# Optional: backup staging data
# BACKUP_S3_BUCKET=your-staging-backup-bucket
# BACKUP_ENCRYPTION_KEY=your-staging-backup-key
BACKUP_RETENTION_FULL=2
BACKUP_RETENTION_DIFF=7
BACKUP_PROCESS_MAX=1

# ============================================
# STAGING CHECKLIST
# ============================================

# Before deploying to staging:
# [ ] Generate unique JWT_SECRET for staging
# [ ] Generate unique TOTP_ENCRYPTION_KEY for staging
# [ ] Set up separate staging database
# [ ] Set up separate staging Redis/Dragonfly
# [ ] Configure staging domain in CORS_ALLOWED_ORIGINS
# [ ] Use Stripe TEST keys (never live keys)
# [ ] Set up staging Sentry project
# [ ] Configure staging email sender
# [ ] Set up staging S3 bucket (optional)

#!/bin/sh
# Post-checkout hook: Auto-sync dependencies when package.json changes

# Arguments: $1=previous HEAD, $2=new HEAD, $3=branch checkout flag (1) or file checkout flag (0)
PREV_HEAD=$1
NEW_HEAD=$2
CHECKOUT_TYPE=$3

# Only run on branch checkouts, not file checkouts
if [ "$CHECKOUT_TYPE" != "1" ]; then
    exit 0
fi

# Check if frontend package.json changed
if git diff --name-only "$PREV_HEAD" "$NEW_HEAD" | grep -q "^frontend/package\.json$"; then
    echo "ðŸ“¦ frontend/package.json changed - running npm install..."

    # Load nvm if available
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

    cd frontend && npm install --prefer-offline --no-audit
    echo "âœ“ Frontend dependencies synced"
fi

# Check if backend go.mod changed
if git diff --name-only "$PREV_HEAD" "$NEW_HEAD" | grep -q "^backend/go\.\(mod\|sum\)$"; then
    echo "ðŸ“¦ backend/go.mod changed - running go mod download..."
    cd backend && go mod download
    echo "âœ“ Backend dependencies synced"
fi

# ============================================
# React + Go Starter Kit - Production Environment Template
# ============================================
# USAGE: Copy this file to .env.prod and fill in your values
#   cp .env.prod.example .env.prod
#
# WARNING: Never commit .env.prod to version control!
# Use your deployment platform's secrets management for sensitive values.
#
# DEPLOYMENT ARCHITECTURE:
# - Backend: Docker (make prod) - exposes port 8080
# - Frontend: Deploy separately to Vercel, Cloudflare Pages, S3, or any CDN
#   - Build: cd frontend && npm run build (or make frontend-build)
#   - Deploy the frontend/dist/ folder to your static host
#   - Set VITE_API_URL to your backend URL before building
#
# Your external reverse proxy (nginx, Cloudflare, etc.) handles:
# - TLS termination
# - Routing: /api/* -> backend:8080, /* -> frontend CDN

# ============================================
# 1. CORE APPLICATION SETTINGS
# ============================================

# Server configuration
API_PORT=8080
API_HOST=0.0.0.0

# Environment mode
GO_ENV=production

# Disable debug mode in production
DEBUG=false

# Server timeout for requests
SERVER_TIMEOUT=30s

# ============================================
# 2. DOCKER CONFIGURATION
# ============================================

# Project name prefix for Docker containers and networks
PROJECT_NAME=starter-kit

# Exposed port on host for production Docker deployment
BACKEND_PORT=8080

# ============================================
# 3. DATABASE CONFIGURATION
# ============================================

# PostgreSQL connection settings
# Use environment variables or secrets manager for sensitive values
DB_HOST=postgres
DB_PORT=5432
DB_USER=produser
DB_PASSWORD=your-secure-database-password
DB_NAME=starter_kit_prod

# Always use SSL in production
DB_SSLMODE=require

# Railway PostgreSQL (if using Railway)
# PGHOST=your-railway-host.railway.internal
# PGPORT=5432
# PGUSER=postgres
# PGPASSWORD=your-railway-password
# PGDATABASE=railway

# Connection Pool Settings (optimized for production)
DB_POOL_MAX_CONNS=25
DB_POOL_MIN_CONNS=5
DB_POOL_MAX_CONN_LIFETIME_MINUTES=5
DB_POOL_MAX_CONN_IDLE_TIME_MINUTES=1
DB_POOL_HEALTH_CHECK_SECONDS=30

# Query Profiling
DB_SLOW_QUERY_THRESHOLD=100ms
DB_LOG_ALL_QUERIES=false

# ============================================
# 4. AUTHENTICATION & SECURITY
# ============================================

# JWT secret key - GENERATE A NEW ONE FOR PRODUCTION!
# Run: openssl rand -hex 32
JWT_SECRET=your-jwt-secret-here-generate-with-openssl-rand-hex-32

# Token expiration settings
JWT_EXPIRATION_HOURS=24
ACCESS_TOKEN_EXPIRATION_MINUTES=15
REFRESH_TOKEN_EXPIRATION_DAYS=7

# Cookie settings - strict for production CSRF protection
COOKIE_SAMESITE=strict

# Token blacklist behavior on DB error: "closed" (deny) for production
TOKEN_BLACKLIST_FAIL_MODE=closed

# CSRF Protection
CSRF_ENABLED=true
CSRF_COOKIE_SECURE=true
CSRF_COOKIE_DOMAIN=yourdomain.com
CSRF_COOKIE_SAMESITE=strict

# Security Headers
SECURITY_HEADERS_ENABLED=true
SECURITY_CSP="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'"
SECURITY_FRAME_OPTIONS=DENY
SECURITY_HSTS_ENABLED=true
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin
SECURITY_PERMISSIONS_POLICY="geolocation=(), microphone=(), camera=()"

# TOTP/2FA
TOTP_ISSUER=YourAppName
SITE_NAME=YourAppName
# Generate with: openssl rand -hex 16
TOTP_ENCRYPTION_KEY=your-32-character-encryption-key

# ============================================
# 5. CORS CONFIGURATION
# ============================================

# Production frontend URLs (comma-separated)
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# WebSocket allowed origins (uses CORS_ALLOWED_ORIGINS if not set)
# ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# ============================================
# 6. RATE LIMITING
# ============================================

RATE_LIMIT_ENABLED=true

# IP-based limits (production values)
RATE_LIMIT_IP_PER_MINUTE=60
RATE_LIMIT_IP_PER_HOUR=1000
RATE_LIMIT_IP_BURST_SIZE=10

# User-based limits
RATE_LIMIT_USER_PER_MINUTE=100
RATE_LIMIT_USER_PER_HOUR=2000
RATE_LIMIT_USER_BURST_SIZE=20

# Auth endpoint limits (stricter to prevent brute force)
RATE_LIMIT_AUTH_PER_MINUTE=5
RATE_LIMIT_AUTH_PER_HOUR=100
RATE_LIMIT_AUTH_BURST_SIZE=2

# API endpoint limits
RATE_LIMIT_API_PER_MINUTE=100
RATE_LIMIT_API_PER_HOUR=2000
RATE_LIMIT_API_BURST_SIZE=20

# Trusted proxies (comma-separated CIDRs) - configure for your infrastructure
# RATE_LIMIT_TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12

# ============================================
# 7. LOGGING CONFIGURATION
# ============================================

LOG_ENABLED=true
LOG_LEVEL=info
LOG_PRETTY=false

# User context for debugging (include user ID in logs)
LOG_INCLUDE_USER_CONTEXT=true

# Do not log request/response bodies in production (security)
LOG_INCLUDE_REQUEST_BODY=false
LOG_INCLUDE_RESPONSE_BODY=false

# Size limits (bytes)
LOG_MAX_REQUEST_BODY_SIZE=1024
LOG_MAX_RESPONSE_BODY_SIZE=1024

# Performance: sample 10% of requests for high-traffic apps
LOG_SAMPLING_RATE=0.1

# Async logging for better performance
LOG_ASYNC=true

# Security: sanitize sensitive data
LOG_SANITIZE_HEADERS=true
LOG_FILTER_SENSITIVE=true
LOG_ALLOWED_HEADERS=accept,content-type,user-agent,x-request-id,x-forwarded-for

# ISO 8601 timestamp format
LOG_TIME_FORMAT=2006-01-02T15:04:05Z07:00

# ============================================
# 8. CACHING CONFIGURATION (Dragonfly/Redis)
# ============================================

CACHE_ENABLED=true
CACHE_TYPE=redis
CACHE_KEY_PREFIX=prod

# Redis/Dragonfly connection
# For Docker: redis://dragonfly:6379/0
# For external Redis: redis://:password@hostname:6379/0
REDIS_URL=redis://dragonfly:6379/0

# Redis password - REQUIRED for production!
# Generate with: openssl rand -hex 16
REDIS_PASSWORD=your-secure-redis-password

# Redis is required for production (fail if unavailable)
REDIS_REQUIRED=true

# Dragonfly memory configuration for production
# Memory sizing guide:
#   512MB  - Small production (10k-50k cached keys)
#   1GB    - Medium production (50k-200k cached keys)
#   2GB+   - Large production (> 200k cached keys)
DRAGONFLY_MEMORY=512mb
DRAGONFLY_MEMORY_LIMIT=512M
DRAGONFLY_MEMORY_RESERVE=256M

# Redis pool settings for production
REDIS_POOL_SIZE=20
REDIS_MIN_IDLE_CONNS=5
REDIS_MAX_IDLE_CONNS=10

# Cache TTL settings (seconds)
CACHE_DEFAULT_TTL=300
CACHE_HEALTH_CHECK_TTL=30
CACHE_USER_PROFILE_TTL=120
CACHE_SESSION_TTL=900

# ============================================
# 9. FILE STORAGE
# ============================================

# Max file upload size in MB
MAX_FILE_SIZE_MB=10

# AWS S3 (use secrets manager for credentials)
# AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=your-production-bucket

# GDPR Data Exports - use S3 in production
DATA_EXPORTS_DIR=./exports

# ============================================
# 10. DATABASE MIGRATIONS
# ============================================

# Auto-run migrations on startup (set true for containerized deployments)
RUN_MIGRATIONS=true
MIGRATIONS_PATH=./migrations

# ============================================
# 11. BACKGROUND JOBS (River)
# ============================================

JOBS_ENABLED=true
JOBS_WORKER_COUNT=10
JOBS_MAX_RETRIES=3
JOBS_TIMEOUT=30s

# Metrics retention job
METRICS_RETENTION_ENABLED=true
METRICS_RETENTION_DAYS=30

# ============================================
# 12. EMAIL SERVICE (SMTP)
# ============================================

EMAIL_ENABLED=true

# SMTP Configuration
SMTP_HOST=smtp.resend.com
SMTP_PORT=587
SMTP_USER=resend
SMTP_PASSWORD=re_your-resend-api-key
SMTP_TLS_POLICY=required

# Email sender configuration
SMTP_FROM=noreply@yourdomain.com
SMTP_FROM_NAME=Your App Name

# Frontend URL (for email links)
FRONTEND_URL=https://yourdomain.com

# Development mode disabled in production
EMAIL_DEV_MODE=false

# ============================================
# 13. OAUTH PROVIDERS
# ============================================

# Google OAuth
# Get credentials: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=your-google-client-secret

# GitHub OAuth
# Get credentials: https://github.com/settings/developers
# GITHUB_CLIENT_ID=your-github-client-id
# GITHUB_CLIENT_SECRET=your-github-client-secret

# OAuth redirect base URL (defaults to FRONTEND_URL)
# OAUTH_REDIRECT_BASE_URL=https://yourdomain.com

# ============================================
# 14. STRIPE PAYMENTS
# ============================================
#
# IMPORTANT: Use live keys in production (sk_live_*, pk_live_*)
# Get keys from: https://dashboard.stripe.com/apikeys

# STRIPE_ENABLED=true

# API Keys - use LIVE keys for production
# STRIPE_SECRET_KEY=sk_live_your-stripe-secret-key
# STRIPE_PUBLISHABLE_KEY=pk_live_your-stripe-publishable-key

# Webhook secret (create webhook in Stripe Dashboard)
# STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Checkout redirect URLs
STRIPE_SUCCESS_URL=https://yourdomain.com/billing/success
STRIPE_CANCEL_URL=https://yourdomain.com/billing/cancel
STRIPE_PORTAL_RETURN_URL=https://yourdomain.com/billing

# Subscription price IDs
# STRIPE_PREMIUM_PRICE_ID=price_your-premium-price-id
# STRIPE_ENTERPRISE_PRICE_ID=price_your-enterprise-price-id

# ============================================
# 15. AI SERVICES (Gemini)
# ============================================

# GEMINI_ENABLED=true
# GEMINI_API_KEY=your-gemini-api-key
GEMINI_MODEL=gemini-2.0-flash
GEMINI_EMBEDDING_MODEL=text-embedding-004
GEMINI_MAX_TOKENS=8192
GEMINI_TIMEOUT_SECONDS=30
GEMINI_MAX_IMAGE_SIZE_MB=10

# Safety settings (none, low, medium, high, block_all)
GEMINI_SAFETY_LEVEL=medium

# Input validation limits
GEMINI_MAX_PROMPT_LENGTH=100000
GEMINI_MAX_MESSAGES_PER_CHAT=50
GEMINI_MAX_TEXTS_PER_EMBED=100

# Feature flags
GEMINI_ALLOW_FUNCTION_CALLING=true
GEMINI_ALLOW_JSON_MODE=true

# AI-specific rate limiting (more restrictive to control costs)
RATE_LIMIT_AI_PER_MINUTE=20
RATE_LIMIT_AI_PER_HOUR=200
RATE_LIMIT_AI_BURST_SIZE=5

# ============================================
# 16. MONITORING & ERROR TRACKING
# ============================================

# Sentry (Backend)
# SENTRY_DSN=https://your-sentry-dsn@o123456.ingest.sentry.io/123456
SENTRY_ENVIRONMENT=production
SENTRY_DEBUG=false
APP_VERSION=1.0.0

# ============================================
# 17. FRONTEND (Vite)
# ============================================

# API URL (set to your production backend URL)
VITE_API_URL=https://api.yourdomain.com

# SSR API URL (for server-side rendering, internal network)
SSR_API_URL=http://backend:8080

# Sentry (Frontend)
# VITE_SENTRY_DSN=https://your-frontend-sentry-dsn@o123456.ingest.sentry.io/789012
VITE_SENTRY_ENABLE_DEV=false
VITE_APP_VERSION=1.0.0

# Feature Flags
VITE_FEATURE_NEW_DASHBOARD_LAYOUT=true
VITE_FEATURE_BETA_ANALYTICS=false
VITE_FEATURE_ADVANCED_FILE_UPLOAD=true
VITE_FEATURE_USER_ROLES_MANAGEMENT=false
VITE_FEATURE_DARK_MODE_TOGGLE=true
VITE_FEATURE_EXPERIMENTAL_CHARTS=false

# Debug settings disabled in production
VITE_ENABLE_DEVTOOLS=false
VITE_DEBUG_MODE=false

# ============================================
# 18. DATABASE SEEDING
# ============================================

# Seeding disabled in production
AUTO_SEED=false

# ============================================
# 19. DATABASE BACKUPS (pgBackRest)
# ============================================

# S3 bucket for storing backups
BACKUP_S3_BUCKET=your-backup-bucket-name

# AWS credentials for backup storage
# Recommendation: Use IAM roles in production instead of access keys
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=us-east-1

# Backup encryption key - CRITICAL: Store this securely!
# Generate with: openssl rand -base64 48
# Losing this key means unrecoverable backups
# BACKUP_ENCRYPTION_KEY=your-backup-encryption-key

# Retention policy
BACKUP_RETENTION_FULL=4        # Keep 4 full backups (~1 month with weekly fulls)
BACKUP_RETENTION_DIFF=30       # Keep 30 days of incremental backups

# Performance tuning
BACKUP_PROCESS_MAX=2           # Parallel processes for backup/restore

# Slack notifications (optional)
# BACKUP_SLACK_WEBHOOK=https://hooks.slack.com/services/xxx/yyy/zzz

# ============================================
# PRODUCTION CHECKLIST
# ============================================

# Before deploying to production:
# [ ] Generate new JWT_SECRET: openssl rand -hex 32
# [ ] Generate TOTP_ENCRYPTION_KEY: openssl rand -hex 16
# [ ] Generate REDIS_PASSWORD: openssl rand -hex 16
# [ ] Configure database with SSL (DB_SSLMODE=require)
# [ ] Set up Redis/Dragonfly for caching and sessions
# [ ] Update CORS_ALLOWED_ORIGINS with your domain(s)
# [ ] Configure SSL/TLS certificates (handled by reverse proxy)
# [ ] Set up monitoring and alerting (Sentry, Datadog, etc.)
# [ ] Configure log aggregation (CloudWatch, Papertrail, etc.)
# [ ] Configure backup settings (S3 bucket, encryption key)
# [ ] Enable security headers (CSP, HSTS, X-Frame-Options)
# [ ] Review and test rate limiting settings
# [ ] Test backup and restore procedures before going live
# [ ] Set up OAuth providers if using social login
# [ ] Configure Stripe with LIVE keys if using payments
